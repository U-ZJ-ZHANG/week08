name: CD - Deploy Frontend to AKS

on:
  workflow_dispatch:

jobs:
  deploy_frontend:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Azure Login
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    # 设置 AKS context
    - name: Set Kubernetes context
      run: |
        az aks get-credentials --resource-group sit722-rg --name sit722-aks --overwrite-existing

    # 部署前端服务，写死 ACR 地址
    - name: Deploy Frontend
      run: |
        kubectl set image deployment/frontend-deployment frontend=sit722devopszzjacr.azurecr.io/frontend:latest -n default
        kubectl rollout status deployment/frontend-deployment -n default

    - name: Logout from Azure
      run: az logout
      if: always()
